1. Количество карточек в Done по командам

```sql
select distinct t.id                                                                  t_id,
                                   count(distinct json_unquote(json_extract(ta.data, '$.data.card.id'))) c_done
                   from pm_trace.pm_trace_action ta
                            left join pm_trace.pm_trace_board b on ta.board_id = b.id
                            left join pm_trace.pm_trace_project ptp on b.project_id = ptp.id
                            left join people.project p on p.guid = ptp.guid
                            left join people.project_team pt on p.id = pt.projectID
                            left join people.team t on pt.teamID = t.id
                            left join people.context_team ct on ct.teamID = t.id
                            left join people.context c on c.id = ct.contextID
                   where (json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%one%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%cдела%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%Сдела%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%отово%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%ыполн%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%остигнутые%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%заверш%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%Заверш%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%ЗАВЕРШЕННЫЕ%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%ешено%' or
                          json_unquote(json_extract(ta.data, '$.data.listAfter.name')) like '%сполненн%')
                     and t.id is not null
                     and c.id = 245
                     and t.universityID in (27, 275, 41, 135, 117, 10, 127, 212, 121, 12, 290, 283)
                     and t.universityID is not null
                     and t.active = 1
                     and p.active = 1
                     and date(ta.external_creation_time) > '2020-04-10'
                   group by t.id
```



2. Содержание и действия с карточками
```sql
select distinct t.universityID,
                t.title t_title,
                t.id t_id,
                p.id p_id,
                p.title p_title,
                ta.id task_id,
                if(ta.description is not null and ta.description!='',1,0) 'descr',
                if(ta.description='',1,0) 'no_descr',
                ta.description,
                ta.external_id_source
from (select distinct t.id, t.title, t.universityID
      from people.team t
      where t.active = 1
        and t.universityID in (27, 275, 41, 135, 117, 10, 127, 212, 121, 12, 290, 283)) t
         inner join (select * from people.context_team ct where ct.contextID = 245) ct on ct.teamID = t.id
         left join (select distinct p.guid, pt.teamID,p.title,p.id
                    from people.project p
                             left join people.project_team pt on p.id = pt.projectID
                    where p.active = 1) p on p.teamID = t.id
         left join pm_trace.pm_trace_project ptp on p.guid = ptp.guid
         left join pm_trace.pm_trace_board b on  b.project_id = ptp.id
left join pm_trace.pm_trace_status s on s.board_id = b.id
left join (select * from pm_trace.pm_trace_task ta where date(ta.external_creation_time) > '2020-04-10') ta on ta.status_id = s.id

```
**В pm_trace.pm_trace_task  есть заголовок и описание карточки**  
**В pm_trace.pm_trace_action действия с карточками.  
Например можно вытащить вложение к карточке (пример ниже)**  
```sql
select distinct a,att
from  (select json_unquote(json_extract(ta.data, '$.data.card.id')) a,json_unquote(json_extract(ta.data, '$.data.attachment.id')) att
    from pm_trace.pm_trace_action ta
    where ta.external_type = 'addAttachmentToCard'
      and date(ta.external_creation_time) > '2020-04-10') a
      
```
В json лежат айди карточки, по которому можно соеднить с самой карточкой. Наример:
```sql
pm_trace.pm_trace_task.external_id_source=json_unquote(json_extract(pm_trace.pm_trace_action.data, '$.data.card.id')
```
                   
